<script>
async function loadTeachers() {
  try {
    const res = await fetch('teachers2.json');
    const data = await res.json();
    const container = document.getElementById('teacherContainer');

    for (const [teacherName, teacherInfo] of Object.entries(data)) {
      const baseName = teacherName.toLowerCase().replace(/[^a-z0-9]/g, '');
      const imageExtensions = ['png', 'jpg', 'jpeg', 'webp'];
      let imageSrc = 'placeholder.png';

      for (const ext of imageExtensions) {
        try {
          const testSrc = `${baseName}.${ext}`;
          const r = await fetch(testSrc, { method: 'HEAD' });
          if (r.ok) { imageSrc = testSrc; break; }
        } catch {}
      }

      const card = document.createElement('div');
      card.className = 'teacher-card';

      let classesHTML = '';

      for (const [className, info] of Object.entries(teacherInfo.classes)) {
        classesHTML += `
          <hr style="width:100%; margin:15px 0; border:0; border-top:1px solid #ccc;">
          <h3 style="color:#145a32; text-align:center;">${className}</h3>

          <div class="responses-badge">${info.response_count} responses</div>
          <div class="would-take-badge">${info.would_take_again_percent_yes}% would take again</div>

          <div class="rating-container">
            <div class="rating-label">Difficulty</div>
            <div class="rating-bar">
              <div class="rating-fill" style="width:${(info.averages.difficulty/5)*100}%"></div>
              <div class="rating-value">${info.averages.difficulty} / 5</div>
            </div>

            <div class="rating-label">Enjoyment</div>
            <div class="rating-bar">
              <div class="rating-fill" style="width:${(info.averages.enjoyment/5)*100}%"></div>
              <div class="rating-value">${info.averages.enjoyment} / 5</div>
            </div>

            <div class="rating-label">Strictness</div>
            <div class="rating-bar">
              <div class="rating-fill" style="width:${(info.averages.strictness/5)*100}%"></div>
              <div class="rating-value">${info.averages.strictness} / 5</div>
            </div>
          </div>

          <div class="average-grade">Average Grade: ${info.average_grade}</div>

          <button type="button" class="collapsible">Comments</button>
          <div class="content">
            <ul>${info.comments.map(c => `<li>${c}</li>`).join('')}</ul>
          </div>

          <button type="button" class="collapsible">Methods to Pass</button>
          <div class="content">
            <ul>${info.methods_to_pass.map(m => `<li>${m}</li>`).join('')}</ul>
          </div>
        `;
      }

      card.innerHTML = `
        <img src="${imageSrc}" alt="${teacherName}" class="teacher-image">
        <h2>${teacherName}</h2>
        <div class="responses-badge">${teacherInfo.total_response_count} total responses</div>
        ${classesHTML}
      `;

      container.appendChild(card);
    }

    document.querySelectorAll(".collapsible").forEach(btn => {
      btn.addEventListener("click", function () {
        this.classList.toggle("active");
        const content = this.nextElementSibling;
        content.style.maxHeight = content.style.maxHeight ? null : content.scrollHeight + "px";
      });
    });

    const searchInput = document.getElementById('searchInput');
    searchInput.addEventListener('input', () => {
      const q = searchInput.value.toLowerCase();
      document.querySelectorAll('.teacher-card').forEach(card => {
        const name = card.querySelector('h2').textContent.toLowerCase();
        card.style.display = name.includes(q) ? '' : 'none';
      });
    });

  } catch (err) {
    console.error(err);
    document.getElementById('teacherContainer').innerHTML =
      "<p>Could not load teacher data.</p>";
  }
}

loadTeachers();
</script>
